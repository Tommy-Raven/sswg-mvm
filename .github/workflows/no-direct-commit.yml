# =====================================================================
# sswg-mvm Governance Rule: PR-Only Enforcement
# File: .github/workflows/no-direct-commit.yml
#
# Purpose:
#   - Block ALL direct pushes to protected branches.
#   - Allow ONLY:
#       * Tommy-Raven (project owner)
#       * GitHub Actions bot performing CI/CD
# =====================================================================

name: üö´ Enforce PR-Only Policy

on:
  push:
    branches:
      - main
      - canonical
      - dev
      - mvm

jobs:
  block-direct-push:
    runs-on: ubuntu-latest

    # ------------------------------------------------------------------
    # Conditions for blocking:
    #   ‚ùå Any human except the owner: blocked
    #   ‚ùå Any unknown service account: blocked
    #   ‚úÖ GitHub Actions bots: allowed
    #   ‚úÖ Repository owner (Tommy-Raven): allowed
    # ------------------------------------------------------------------
    if: >
      github.actor != 'Tommy-Raven' &&
      github.actor != 'github-actions' &&
      github.actor != 'github-actions[bot]'

    steps:
      - name: ‚ùå Reject Direct Push
        run: |
          echo "‚õî Direct push blocked."
          echo ""
          echo "Branch protection is enabled for sswg-mvm."
          echo "Only the repository owner and CI/CD bots may push directly."
          echo ""
          echo "Actor: ${{ github.actor }}"
          echo "You must open a Pull Request instead."
          exit 1
