name: SSWGâ€“MVM: Build & Test Core System

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# EVENT TRIGGERS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches: ["main", "dev"]
    paths:
      - "generator/**"
      - "ai_core/**"
      - "ai_recursive/**"
      - "ai_validation/**"
      - "ai_graph/**"
      - "ai_monitoring/**"
      - "ai_memory/**"
      - "ai_visualization/**"
      - "API/**"
      - ".github/workflows/sswg-build-test.yml"
  pull_request:
    branches: ["main", "dev"]
    paths:
      - "generator/**"
      - "ai_core/**"
      - "ai_recursive/**"
      - "ai_validation/**"
      - "ai_graph/**"
      - "ai_monitoring/**"
      - "ai_memory/**"
      - "ai_visualization/**"
      - "API/**"
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: write

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# JOB 1 â€” BUILD & LINT
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
  build_and_lint:
    name: ğŸ§© Build & Lint (SSWGâ€“MVM Core)
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@82c7e631bb3cfad61ab9166887a6c1b1d5ef5c2
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          # Use reproducibility lock file if available
          if [ -f reproducibility/requirements.txt ]; then
            pip install -r reproducibility/requirements.txt
          elif [ -f REQUIREMENTS.txt ]; then
            pip install -r REQUIREMENTS.txt
          fi
          pip install flake8 pytest

      - name: ğŸ” Lint SSWG Core Modules
        run: |
          echo "Running flake8 linting..."
          flake8 generator ai_core ai_recursive ai_validation ai_graph ai_monitoring ai_memory ai_visualization API --max-line-length=120 --statistics

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 2 â€” UNIT TEST SUITE
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  run_tests:
    name: ğŸ§ª Run Unit Tests
    needs: build_and_lint
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@82c7e631bb3cfad61ab9166887a6c1b1d5ef5c2
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          if [ -f reproducibility/requirements.txt ]; then
            pip install -r reproducibility/requirements.txt
          elif [ -f REQUIREMENTS.txt ]; then
            pip install -r REQUIREMENTS.txt
          fi
          pip install pytest

      - name: ğŸ§ª Execute full test suite
        run: |
          pytest -q tests API/tests generator/tests --disable-warnings --maxfail=1 --tb=short

      - name: ğŸ“Š Upload test results
        if: always()
        uses: actions/upload-artifact@0b2256b8c012f0828dc542b3febcab082c67f72b
        with:
          name: sswg-mvm-test-results
          path: ./tests/

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 3 â€” SUCCESS NOTIFICATION
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  notify:
    name: ğŸ”” Notify Success
    needs: run_tests
    runs-on: ubuntu-latest
    if: success()

    steps:
      - name: ğŸ’¬ Post summary
        run: |
          echo "âœ… SSWGâ€“MVM CI Pipeline completed successfully."

